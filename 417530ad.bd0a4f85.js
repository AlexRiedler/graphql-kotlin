(window.webpackJsonp=window.webpackJsonp||[]).push([[59],{126:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return l})),n.d(t,"toc",(function(){return c})),n.d(t,"default",(function(){return p}));var a=n(3),i=n(7),r=(n(0),n(234)),o={id:"client-customization",title:"Client Customization",original_id:"client-customization"},l={unversionedId:"client/client-customization",id:"version-4.x.x/client/client-customization",isDocsHomePage:!1,title:"Client Customization",description:"Ktor HTTP Client Customization",source:"@site/versioned_docs/version-4.x.x/client/client-customization.md",slug:"/client/client-customization",permalink:"/graphql-kotlin/docs/client/client-customization",editUrl:"https://github.com/ExpediaGroup/graphql-kotlin/tree/master/website/versioned_docs/version-4.x.x/client/client-customization.md",version:"4.x.x",lastUpdatedBy:"Shane Myrick",lastUpdatedAt:1613844876,sidebar:"version-4.x.x/docs",previous:{title:"Client Features",permalink:"/graphql-kotlin/docs/client/client-features"},next:{title:"Gradle Plugin Tasks",permalink:"/graphql-kotlin/docs/plugins/gradle-plugin-tasks"}},c=[{value:"Ktor HTTP Client Customization",id:"ktor-http-client-customization",children:[{value:"Global Client Customization",id:"global-client-customization",children:[]},{value:"Per Request Customization",id:"per-request-customization",children:[]}]},{value:"Spring WebClient Customization",id:"spring-webclient-customization",children:[{value:"Global Client Customization",id:"global-client-customization-1",children:[]},{value:"Per Request Customization",id:"per-request-customization-1",children:[]}]},{value:"Custom GraphQL Client",id:"custom-graphql-client",children:[]},{value:"Jackson Customization",id:"jackson-customization",children:[]},{value:"Deprecated Field Usage",id:"deprecated-field-usage",children:[]},{value:"Custom GraphQL Scalars",id:"custom-graphql-scalars",children:[]}],s={toc:c};function p(e){var t=e.components,n=Object(i.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},s,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("h2",{id:"ktor-http-client-customization"},"Ktor HTTP Client Customization"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"GraphQLKtorClient")," is a thin wrapper on top of ",Object(r.b)("a",{parentName:"p",href:"https://ktor.io/clients/index.html"},"Ktor HTTP Client")," and supports fully\nasynchronous non-blocking communication. It is highly customizable and can be configured with any supported Ktor HTTP\n",Object(r.b)("a",{parentName:"p",href:"https://ktor.io/clients/http-client/engines.html"},"engine")," and ",Object(r.b)("a",{parentName:"p",href:"https://ktor.io/clients/http-client/features.html"},"features"),"."),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"GraphQLKtorClient")," uses the Ktor HTTP Client to execute the underlying queries. Clients can be customized with different\nengines (defaults to Coroutine-based IO) and HTTP client features. Custom configurations can be applied through Ktor DSL\nstyle builders."),Object(r.b)("p",null,"See ",Object(r.b)("a",{parentName:"p",href:"https://ktor.io/clients/index.html"},"Ktor HTTP Client documentation")," for additional details."),Object(r.b)("h3",{id:"global-client-customization"},"Global Client Customization"),Object(r.b)("p",null,"A single instance of ",Object(r.b)("inlineCode",{parentName:"p"},"GraphQLKtorClient")," can be used to handle many GraphQL operations. You can specify a target engine factory and\nconfigure it through the corresponding ",Object(r.b)("a",{parentName:"p",href:"https://api.ktor.io/1.3.2/io.ktor.client/-http-client-config/index.html"},"HttpClientConfig"),".\nKtor also provides a number of ",Object(r.b)("a",{parentName:"p",href:"https://ktor.io/clients/http-client/features.html"},"standard HTTP features")," and\nallows you to easily create custom ones that can be configured globally."),Object(r.b)("p",null,"The below example configures a new ",Object(r.b)("inlineCode",{parentName:"p"},"GraphQLKtorClient")," to use the ",Object(r.b)("inlineCode",{parentName:"p"},"OkHttp")," engine with custom timeouts, adds a default ",Object(r.b)("inlineCode",{parentName:"p"},"X-MY-API-KEY"),"\nheader to all requests, and enables basic logging of the requests."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-kotlin"},'\nval client = GraphQLKtorClient(\n        url = URL("http://localhost:8080/graphql"),\n        engineFactory = OkHttp\n) {\n    engine {\n        config {\n            connectTimeout(10, TimeUnit.SECONDS)\n            readTimeout(60, TimeUnit.SECONDS)\n            writeTimeout(60, TimeUnit.SECONDS)\n        }\n    }\n    defaultRequest {\n        header("X-MY-API-KEY", "someSecretApiKey")\n    }\n    install(Logging) {\n        logger = Logger.DEFAULT\n        level = LogLevel.INFO\n    }\n}\n\n')),Object(r.b)("h3",{id:"per-request-customization"},"Per Request Customization"),Object(r.b)("p",null,"Individual GraphQL requests can be customized through ",Object(r.b)("a",{parentName:"p",href:"https://api.ktor.io/1.3.2/io.ktor.client.request/-http-request-builder/"},"HttpRequestBuilder"),".\nYou can use this mechanism to specify custom headers, update target url to include custom query parameters, configure\nattributes that can be accessed from the pipeline features as well specify timeouts per request."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-kotlin"},'\nval helloWorldQuery = HelloWorldQuery(variables = HelloWorldQuery.Variables(name = "John Doe"))\nval result = client.execute(helloWorldQuery) {\n    header("X-B3-TraceId", "0123456789abcdef")\n}\n\n')),Object(r.b)("h2",{id:"spring-webclient-customization"},"Spring WebClient Customization"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"GraphQLWebClient")," is a thin wrapper on top of ",Object(r.b)("a",{parentName:"p",href:"https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/reactive/function/client/WebClient.html"},"Spring WebClient"),"\nthat relies on Reactor Netty for fully asynchronous non-blocking communications. If you want to use Jetty instead you will\nneed to exclude provided ",Object(r.b)("inlineCode",{parentName:"p"},"io.projectreactor.netty:reactor-netty")," dependency and instead add ",Object(r.b)("inlineCode",{parentName:"p"},"org.eclipse.jetty:jetty-reactive-httpclient"),"\ndependency."),Object(r.b)("h3",{id:"global-client-customization-1"},"Global Client Customization"),Object(r.b)("p",null,"A single instance of ",Object(r.b)("inlineCode",{parentName:"p"},"GraphQLWebClient")," can be used to handle many GraphQL operations and you can customize it by providing\na custom instance of ",Object(r.b)("inlineCode",{parentName:"p"},"WebClient.Builder"),". See ",Object(r.b)("a",{parentName:"p",href:"https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-webclient-customization"},"Spring documentation"),"\nfor additional details."),Object(r.b)("p",null,"Example below configures ",Object(r.b)("inlineCode",{parentName:"p"},"GraphQLWebClient")," with custom timeouts and adds a default ",Object(r.b)("inlineCode",{parentName:"p"},"X-MY-API-KEY")," header to all requests."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-kotlin"},'\nval httpClient: HttpClient = HttpClient.create()\n    .option(ChannelOption.CONNECT_TIMEOUT_MILLIS, 10_000)\n    .responseTimeout(Duration.ofMillis(10_000))\nval connector: ClientHttpConnector = ReactorClientHttpConnector(httpClient.wiretap(true))\nval webClientBuilder = WebClient.builder()\n    .clientConnector(connector)\n    .defaultHeader("X-MY-API-KEY", "someSecretApiKey")\n\nval client = GraphQLWebClient(\n    url = "http://localhost:8080/graphql",\n    builder = webClientBuilder\n)\n\n')),Object(r.b)("h3",{id:"per-request-customization-1"},"Per Request Customization"),Object(r.b)("p",null,"Individual GraphQL requests can be customized by providing ",Object(r.b)("inlineCode",{parentName:"p"},"WebClient.RequestBodyUriSpec")," lambda. You can use this mechanism\nto specify custom headers or include custom attributes or query parameters."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-kotlin"},'\nval helloWorldQuery = HelloWorldQuery(variables = HelloWorldQuery.Variables(name = "John Doe"))\nval result = client.execute(helloWorldQuery) {\n    header("X-B3-TraceId", "0123456789abcdef")\n}\n\n')),Object(r.b)("h2",{id:"custom-graphql-client"},"Custom GraphQL Client"),Object(r.b)("p",null,"GraphQL Kotlin libraries provide generic a ",Object(r.b)("inlineCode",{parentName:"p"},"GraphQLClient")," interface as well as Ktor HTTP Client and Spring WebClient based\nreference implementations. Both ",Object(r.b)("inlineCode",{parentName:"p"},"GraphQLKtorClient")," and ",Object(r.b)("inlineCode",{parentName:"p"},"GraphQLWebClient")," are open classes which means you can also\nextend them to provide some custom ",Object(r.b)("inlineCode",{parentName:"p"},"execute")," logic."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-kotlin"},"\nclass CustomGraphQLClient(url: URL) : GraphQLKtorClient<CIOEngineConfig>(url = url, engineFactory = CIO) {\n\n    override suspend fun <T> execute(request: GraphQLClientRequest, requestCustomizer: HttpRequestBuilder.() -> Unit): GraphQLResponse<T> {\n        // custom init logic\n        val result = super.execute(request, requestCustomizer)\n        // custom finalize logic\n        return result\n    }\n}\n\n")),Object(r.b)("h2",{id:"jackson-customization"},"Jackson Customization"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"GraphQLClient")," relies on Jackson to handle polymorphic types and default enum values. You can specify your own custom\nobject mapper configured with some additional serialization/deserialization features but due to the necessary logic to\nhandle the above, currently we don't support other JSON libraries."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-kotlin"},'\nval customObjectMapper = jacksonObjectMapper()\nval client = GraphQLClient(url = URL("http://localhost:8080/graphql"), mapper = customObjectMapper)\n\n')),Object(r.b)("h2",{id:"deprecated-field-usage"},"Deprecated Field Usage"),Object(r.b)("p",null,"Build plugins will automatically fail generation of a client if any of the specified query files are referencing\ndeprecated fields. This ensures that your clients have to explicitly opt-in into deprecated usage by specifying\n",Object(r.b)("inlineCode",{parentName:"p"},"allowDeprecatedFields")," configuration option."),Object(r.b)("h2",{id:"custom-graphql-scalars"},"Custom GraphQL Scalars"),Object(r.b)("p",null,"By default, custom GraphQL scalars are serialized and ",Object(r.b)("a",{parentName:"p",href:"https://kotlinlang.org/docs/reference/type-aliases.html"},"type-aliased"),"\nto a String. GraphQL Kotlin plugins also support custom serialization based on provided configuration."),Object(r.b)("p",null,"In order to automatically convert between custom GraphQL ",Object(r.b)("inlineCode",{parentName:"p"},"UUID")," scalar type and ",Object(r.b)("inlineCode",{parentName:"p"},"java.util.UUID"),", we first need to create\nour custom ",Object(r.b)("inlineCode",{parentName:"p"},"ScalarConverter"),"."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-kotlin"},"\npackage com.example.client\n\nimport com.expediagroup.graphql.client.converter.ScalarConverter\nimport java.util.UUID\n\nclass UUIDScalarConverter : ScalarConverter<UUID> {\n    override fun toScalar(rawValue: Any): UUID = UUID.fromString(rawValue.toString())\n    override fun toJson(value: UUID): Any = value.toString()\n}\n\n")),Object(r.b)("p",null,"And then configure build plugin by specifying"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"Custom GraphQL scalar name"),Object(r.b)("li",{parentName:"ul"},"Target class name"),Object(r.b)("li",{parentName:"ul"},"Converter that provides logic to map between GraphQL and Kotlin type")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-kotlin"},'\ngraphql {\n    packageName = "com.example.generated"\n    endpoint = "http://localhost:8080/graphql"\n    customScalars = listOf(GraphQLScalar("UUID", "java.util.UUID", "com.example.UUIDScalarConverter"))\n}\n\n')),Object(r.b)("p",null,"See ",Object(r.b)("a",{parentName:"p",href:"/graphql-kotlin/docs/plugins/gradle-plugin-tasks"},"Gradle")," and ",Object(r.b)("a",{parentName:"p",href:"/graphql-kotlin/docs/plugins/maven-plugin-goals"},"Maven")," plugin documentation for additional details."))}p.isMDXComponent=!0},234:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return m}));var a=n(0),i=n.n(a);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=i.a.createContext({}),p=function(e){var t=i.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=p(e.components);return i.a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},b=i.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,o=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),u=p(n),b=a,m=u["".concat(o,".").concat(b)]||u[b]||d[b]||r;return n?i.a.createElement(m,l(l({ref:t},s),{},{components:n})):i.a.createElement(m,l({ref:t},s))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,o=new Array(r);o[0]=b;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:a,o[1]=l;for(var s=2;s<r;s++)o[s]=n[s];return i.a.createElement.apply(null,o)}return i.a.createElement.apply(null,n)}b.displayName="MDXCreateElement"}}]);